<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Question for Khushboo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@400;700&family=Caveat&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        /* Base styles */
        html, body { height: 100%; }
        body {
            font-family: 'Poppins', 'Arial', sans-serif;
            background: linear-gradient(135deg, #ffdde1 0%, #ee9ca7 100%);
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; padding: 2rem 1rem; box-sizing: border-box;
            overflow-y: auto;
        }
        .romantic-font { font-family: 'Pacifico', cursive; }
        .handwritten-font { font-family: 'Caveat', cursive; font-size: 1.75rem; line-height: 1.4; }

        /* Interactive & Animation Styles */
        #no-button.moving { position: fixed; transition: top 0.3s ease, left 0.3s ease, transform 0.3s ease; z-index: 50; }
        .heart-bg { position: absolute; font-size: 20px; color: rgba(255, 105, 180, 0.15); animation: float 8s ease-in-out infinite; user-select: none; pointer-events: none; z-index: 0; }
        @keyframes float { 0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.15; } 50% { transform: translateY(-25px) rotate(15deg); opacity: 0.4; } }
        .confetti { position: fixed; opacity: 1; pointer-events: none; z-index: 9999; transition: transform 1s linear, opacity 1s linear; }
        .pulsing-heart { font-size: 4rem; color: #e11d48; animation: pulse 1.5s ease-in-out infinite; display: inline-block; cursor: pointer; transition: color 0.3s ease; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.15); } }
        .fade-in-slow { animation: fadeInAnimation 1.2s ease-in forwards; opacity: 0; }
        @keyframes fadeInAnimation { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .action-button { padding: 12px 28px; font-size: 1rem; border-radius: 50px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 6px rgba(0,0,0,0.1); display: inline-block; margin-top: 15px; min-width: 160px; border: none; }
        .action-button:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0,0,0,0.15); }
        .action-button:disabled { opacity: 0.7; cursor: not-allowed; background-image: none; background-color: #9ca3af; }

        /* Main container adjustments */
        #main-container { width: 100%; max-width: 600px; margin: auto; padding: 2rem 1.5rem; background-color: rgba(255, 255, 255, 0.92); border-radius: 1.5rem; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .content-container { text-align: center; width: 100%; padding: 0; }
        .content-container > *:not(:last-child) { margin-bottom: 1.5rem; }

        /* Input styling */
        input[type="date"], input[type="time"], textarea, input[type="text"], input[type="tel"], input[type="number"], select { border: 1px solid #f472b6; padding: 10px 14px; border-radius: 10px; background-color: white; margin-top: 5px; width: 100%; font-size: 0.95rem; box-sizing: border-box; }
        textarea { resize: vertical; min-height: 70px; }
        input[type="date"], input[type="time"], select { cursor: pointer; }
        input:focus, textarea:focus, select:focus { outline: none; box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.3); }
        .radio-label { display: block; margin-bottom: 10px; cursor: pointer; background-color: rgba(255,255,255,0.6); padding: 10px 15px; border-radius: 8px; transition: background-color 0.3s ease; border: 1px solid transparent; }
        .radio-label:has(input:checked) { background-color: rgba(255, 105, 180, 0.2); border-color: #f472b6; }
        .radio-input { margin-right: 10px; accent-color: #ec4899; transform: scale(1.1); }
        .form-label { display: block; text-align: left; font-weight: bold; color: #4b5563; margin-bottom: 0.25rem; font-size: 0.9rem;}
        .instruction-label { display: inline-flex; align-items: center; margin-right: 1rem; cursor: pointer; font-size: 0.9rem; color: #4b5563;}
        .instruction-checkbox { margin-right: 0.5rem; accent-color: #db2777; width: 1rem; height: 1rem;}
        /* Height Input Specific */
        .height-input-group { display: flex; gap: 0.5rem; align-items: flex-end; }
        .height-input-group input { width: auto; flex-grow: 1; }
        .height-input-group span { padding-bottom: 10px; color: #4b5563; font-size: 0.9rem;}


        /* Page Specific Styles & Loading Spinner */
        #page2-state { background: radial-gradient(circle, rgba(255,255,255,0.5) 0%, rgba(255,223,230,0.3) 70%); border-radius: 15px; padding: 20px; }
        #page4-game-area { position: relative; height: 200px; background-color: rgba(255, 182, 193, 0.2); border-radius: 10px; margin-top: 1rem; border: 1px dashed #f472b6; overflow: hidden; }
        #clickable-heart { position: absolute; font-size: 3rem; color: red; cursor: pointer; transition: top 0.1s, left 0.1s; user-select: none; }
        #page5-state input[type="text"] { margin-bottom: 0.75rem; }
        #page6-state .star { position: absolute; color: #ffd700; font-size: 1rem; animation: twinkle 3s infinite ease-in-out; opacity: 0; }
        @keyframes twinkle { 0%, 100% { opacity: 0; transform: scale(0.5); } 50% { opacity: 1; transform: scale(1); } }
        #page7-state .final-burst { font-size: 4rem; animation: burst 1s ease-out forwards; }
        @keyframes burst { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .rating-stars span { font-size: 2rem; cursor: pointer; color: #cbd5e1; transition: color 0.2s ease; }
        .rating-stars span:hover, .rating-stars span.active { color: #facc15; }
        .checkmark-container { width: 80px; height: 80px; margin: 1.5rem auto; }
        .checkmark-circle { stroke-dasharray: 166; stroke-dashoffset: 166; stroke-width: 3; stroke-miterlimit: 10; stroke: #7ac142; fill: none; animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards; }
        .checkmark { transform-origin: 50% 50%; stroke-dasharray: 48; stroke-dashoffset: 48; animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.6s forwards; }
        .checkmark-check { transform-origin: 50% 50%; stroke-dasharray: 48; stroke-dashoffset: 48; stroke-width: 3; stroke: #7ac142; fill: none; animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards; }
        @keyframes stroke { 100% { stroke-dashoffset: 0; } }
        .loader { border: 5px solid #f3f3f3; border-top: 5px solid #ec4899; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 2rem auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    </style>
</head>
<body> <div id="hearts-bg-container" class="fixed inset-0 z-0 overflow-hidden pointer-events-none"></div>

    <div id="main-container" class="relative z-10 rounded-2xl shadow-xl text-center mx-auto">

        <div id="question-state" class="content-container"> <h1 id="question-text" class="text-2xl md:text-3xl font-bold text-pink-600 romantic-font">üíñ Will you be my girlfriend Khushboo? üíñ</h1> <div id="button-container" class="flex flex-col sm:flex-row justify-center items-center space-y-4 sm:space-y-0 sm:space-x-6 mt-4 relative min-h-[5rem]"> <button id="yes-button" class="action-button bg-green-500 hover:bg-green-600 text-white w-full sm:w-auto">Yes! ü•∞</button> <button id="no-button" class="action-button bg-red-500 hover:bg-red-600 text-white w-full sm:w-auto">No üòü</button> </div> </div>
        <div id="eligibility-form-state" class="hidden fade-in-slow content-container"> <h2 class="text-2xl md:text-3xl font-bold text-purple-600 romantic-font">Hold On! Eligibility Check Required! üßê</h2> <p class="text-gray-700 text-lg">To proceed, please confirm a few details...</p> <form id="eligibility-form" class="text-left max-w-md mx-auto space-y-4 mt-4"> <div> <label for="eligibility-name" class="form-label">Your Full Name:</label> <input type="text" id="eligibility-name" name="eligibility_name" required> </div> <div> <label for="eligibility-birthday" class="form-label">Date of Birth:</label> <input type="date" id="eligibility-birthday" name="eligibility_birthday" required> </div> <div> <label class="form-label">Height (Approx is fine!):</label> <div class="height-input-group"> <input type="number" id="eligibility-height-ft" name="eligibility_height_ft" placeholder="Feet" min="3" max="7" required> <span>ft</span> <input type="number" id="eligibility-height-in" name="eligibility_height_in" placeholder="Inches" min="0" max="11" required> <span>in</span> </div> </div> <div> <label for="eligibility-rating" class="form-label">Rate My Persistence (1=A little, 5=Impressive!):</label> <select id="eligibility-rating" name="eligibility_rating" required> <option value="" disabled selected>Select a rating...</option> <option value="1">1 ‚≠ê</option> <option value="2">2 ‚≠ê‚≠ê</option> <option value="3">3 ‚≠ê‚≠ê‚≠ê</option> <option value="4">4 ‚≠ê‚≠ê‚≠ê‚≠ê</option> <option value="5">5 ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (Wow!)</option> </select> </div> <div> <label for="eligibility-fav-color" class="form-label">Favorite Color (Optional but appreciated!):</label> <input type="text" id="eligibility-fav-color" name="eligibility_fav_color" placeholder="e.g., Sky Blue, Sunshine Yellow"> </div> <div> <label class="form-label">Coffee or Tea Person?</label> <div class="flex space-x-4 justify-center mt-1"> <label class="radio-label flex-1"><input type="radio" name="eligibility_drink" value="Coffee" class="radio-input"> Coffee ‚òï</label> <label class="radio-label flex-1"><input type="radio" name="eligibility_drink" value="Tea" class="radio-input"> Tea üçµ</label> <label class="radio-label flex-1"><input type="radio" name="eligibility_drink" value="Both/Other" class="radio-input"> Both/Other</label> </div> </div> <button type="submit" id="submit-eligibility-button" class="action-button bg-blue-500 hover:bg-blue-600 text-white w-full"> Submit & Check Eligibility... ü§û </button> <p id="eligibility-error" class="text-red-500 text-sm mt-2 hidden text-center">Oops! Please fill out all required fields accurately!</p> </form> </div>
        <div id="verifying-state" class="hidden fade-in-slow content-container"> <h2 class="text-2xl md:text-3xl font-bold text-gray-700 romantic-font">Verifying Eligibility...</h2> <p class="text-gray-600 text-lg">Running complex algorithms... checking star alignment...</p> <div class="loader"></div> <p class="text-sm text-gray-500">(This might take a moment... important stuff!)</p> </div>
        <div id="eligible-state" class="hidden fade-in-slow content-container"> <div class="text-6xl mb-4">üéâüíØ‚úÖ</div> <h2 class="text-3xl md:text-4xl font-bold text-green-600 romantic-font">Congratulations! Eligible!</h2> <p class="text-gray-700 text-lg">You've met the (extremely high) standards required to proceed!</p> <p class="text-sm text-gray-500">(Phew! That was close üòâ)</p> </div>
        <div id="rejection-message-state" class="hidden fade-in-slow content-container"> <div class="text-6xl mb-4">ü§îüö´‚ùì</div> <h2 class="text-2xl md:text-3xl font-bold text-red-600 romantic-font">Eligibility Check Failed...</h2> <p class="text-gray-700 text-lg">You are not the girl I am looking for. Thank you for your shown interest.</p> <p class="text-gray-600 text-md">If in future I think about it we can think of it..</p> <button id="goto-rejection-form-button" class="action-button bg-gray-500 hover:bg-gray-600 text-white">Continue...</button> </div>
        <div id="rejection-form-state" class="hidden fade-in-slow content-container"> <h2 class="text-2xl md:text-3xl font-bold text-gray-700 romantic-font">For Future Reference...</h2> <p class="text-gray-600 text-lg">If you'd like, please leave your contact details below.</p> <form id="rejection-form" class="text-left max-w-md mx-auto space-y-4 mt-4"> <div> <label for="rejection-mobile" class="form-label">Mobile Number (with country code, e.g., 91xxxxxxxxxx):</label> <input type="tel" id="rejection-mobile" name="rejection_mobile" pattern="[0-9]{10,15}" placeholder="e.g. 911234567890" required> </div> <div> <label for="rejection-insta" class="form-label">Instagram ID (Optional):</label> <input type="text" id="rejection-insta" name="rejection_insta" placeholder="@your_insta"> </div> <div> <label for="rejection-snap" class="form-label">Snapchat ID (Optional):</label> <input type="text" id="rejection-snap" name="rejection_snap" placeholder="your_snap_id"> </div> <button type="submit" id="submit-rejection-button" class="action-button bg-purple-500 hover:bg-purple-600 text-white w-full"> Submit Contact Info </button> <p id="rejection-form-error" class="text-red-500 text-sm mt-2 hidden text-center">Please enter a valid mobile number format.</p> <p id="rejection-sending-info" class="text-gray-500 text-sm mt-2 hidden text-center">Submitting...</p> </form> </div>
        <div id="rejection-thanks-state" class="hidden fade-in-slow content-container"> <div class="text-6xl mb-4">üëç‚úâÔ∏è</div> <h2 class="text-2xl md:text-3xl font-bold text-gray-700 romantic-font">Thank You!</h2> <p class="text-gray-600 text-lg">Your contact information has been noted.</p> <p class="text-sm text-gray-500">(Maybe we'll connect in the future!)</p> </div>
        <div id="gift-state" class="hidden fade-in-slow content-container"> <h2 class="text-2xl md:text-3xl font-bold text-pink-600 romantic-font">Okay, Now For Real... Click the Gift!</h2> <button id="gift-box" class="text-6xl md:text-8xl cursor-pointer animate-bounce">üéÅ</button> </div>
        <div id="final-state" class="hidden fade-in-slow content-container"> <h1 class="text-3xl md:text-4xl font-bold text-pink-600 romantic-font animate-pulse">Yay! You made me so happy! ü•∞</h1> <p class="text-gray-800 text-lg">So... when and where for our first date? üòâ</p> <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-left"> <div><label for="date-input" class="block text-sm font-medium text-gray-700 mb-1">Pick a Date:</label><input type="date" id="date-input" name="date"></div> <div><label for="time-input" class="block text-sm font-medium text-gray-700 mb-1">Pick a Time:</label><input type="time" id="time-input" name="time"></div> </div> <div class="text-left mt-4"> <label class="block text-sm font-medium text-gray-700 mb-2">Date Idea:</label> <label class="radio-label"><input type="radio" name="date_idea" value="Coffee & Chat ‚òï" class="radio-input"> Coffee & Chat ‚òï</label> <label class="radio-label"><input type="radio" name="date_idea" value="Movie Night üé¨üçø" class="radio-input"> Movie Night üé¨üçø</label> <label class="radio-label"><input type="radio" name="date_idea" value="Dinner Date üçΩÔ∏è‚ú®" class="radio-input"> Dinner Date üçΩÔ∏è‚ú®</label> <label class="radio-label"><input type="radio" name="date_idea" value="Custom" class="radio-input" id="radio-custom"> Something else...</label> <textarea id="custom-idea-text" name="custom_idea" placeholder="Your amazing date idea..." class="mt-2 hidden"></textarea> </div> <div class="text-left mt-6 border-t border-pink-200 pt-4"> <p class="text-sm font-bold text-gray-600 mb-2">Optional Date Perks (Check any that apply! üòâ):</p> <div class="flex flex-wrap justify-center gap-x-4 gap-y-2"> <label class="instruction-label"> <input type="checkbox" id="instruction-flowers" name="instruction_flowers" class="instruction-checkbox"> Bring flowers? üåπ </label> <label class="instruction-label"> <input type="checkbox" id="instruction-chocolate" name="instruction_chocolate" class="instruction-checkbox"> Chocolate involved? üç´ </label> <label class="instruction-label"> <input type="checkbox" id="instruction-punctual" name="instruction_punctual" class="instruction-checkbox"> Be on time! ‚è∞ </label> </div> <div class="mt-3"> <label for="custom-instruction-input" class="form-label text-sm text-gray-600">Any other requests/instructions?</label> <textarea id="custom-instruction-input" name="custom_instruction" placeholder="e.g., 'Pick me up', 'Wear something nice!'" rows="2"></textarea> </div> </div> <button id="date-confirm-button" class="action-button bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white"> Got it, What's Next? ‚ú® </button> <p id="date-error" class="text-red-500 text-sm mt-2 hidden">Please select Date, Time, and a Date Idea (or write one!).</p> </div>
        <div id="page1-state" class="hidden fade-in-slow content-container"> <h2 class="text-2xl md:text-3xl font-bold text-purple-600 romantic-font">Okay, Date Info Noted! üìù</h2> <p class="text-gray-700 text-lg">Just a couple more things...</p> <button id="goto-page2-button" class="action-button bg-pink-500 hover:bg-pink-600 text-white">Continue... üéâ</button> </div>
        <div id="page2-state" class="hidden fade-in-slow content-container" style="background: radial-gradient(circle, rgba(255,255,255,0.5) 0%, rgba(255,223,230,0.3) 70%); border-radius: 15px; padding: 20px;"> <div id="interactive-heart" class="pulsing-heart mb-6" onclick="changeHeartColor()">‚ù§Ô∏è</div> <p class="text-gray-800 text-xl italic leading-relaxed">"Meeting you was like listening to a song for the first time and knowing it would be my favorite."</p> <p class="text-sm text-gray-600 mt-2">(Click the heart!)</p> <button id="goto-page3-button" class="action-button bg-teal-500 hover:bg-teal-600 text-white">Next Challenge... üòâ</button> </div>
        <div id="page3-state" class="hidden fade-in-slow content-container"> <div class="text-6xl mb-4 animate-bounce">üòä</div> <h2 class="text-3xl md:text-4xl font-bold text-orange-500 romantic-font">Quick! Compliment Me Back!</h2> <p class="text-gray-700 text-lg handwritten-font">What's one nice thing you'd say about me?</p> <input type="text" id="compliment-input" placeholder="(Be nice! üòâ)" class="mt-2"> <button id="compliment-next-button" class="action-button bg-cyan-500 hover:bg-cyan-600 text-white mt-4"> Send & Play Game! ü§î </button> <p id="compliment-sending-info" class="text-gray-500 text-sm mt-2 hidden">Sending info...</p> </div>
        <div id="page4-state" class="hidden fade-in-slow content-container"> <h2 class="text-2xl md:text-3xl font-bold text-lime-600 romantic-font">Quick! Click the Heart!</h2> <p class="text-gray-700 text-lg mt-4">You have 10 seconds... Go!</p> <div id="page4-game-area"> <span id="clickable-heart" style="display: none;">üíñ</span> </div> <p class="mt-2">Score: <span id="game-score">0</span> | Time Left: <span id="game-time">10</span>s</p> <p id="game-message" class="text-pink-600 font-bold mt-2"></p> <button id="goto-page5-button" class="action-button bg-yellow-500 hover:bg-yellow-600 text-white block mx-auto mt-6 hidden">Next: Mad Libs! ü§û</button> </div>
        <div id="page5-state" class="hidden fade-in-slow content-container"> <h2 class="text-2xl md:text-3xl font-bold text-fuchsia-600 romantic-font">Let's Write a Silly Story!</h2> <p class="text-gray-700 text-lg">Fill in the blanks:</p> <div class="text-left max-w-xs mx-auto space-y-3"> <input type="text" id="madlib-adj1" placeholder="An Adjective (e.g., sparkly)"> <input type="text" id="madlib-noun1" placeholder="A Noun (e.g., unicorn)"> <input type="text" id="madlib-verb1" placeholder="A Verb (e.g., dances)"> <input type="text" id="madlib-place1" placeholder="A Place (e.g., moon)"> </div> <button id="generate-madlib" class="action-button bg-blue-500 hover:bg-blue-600 text-white mt-4">Generate Story!</button> <p id="madlib-result" class="text-gray-800 text-lg italic mt-4 p-3 bg-pink-100 rounded-lg hidden"></p> <button id="goto-page6-button" class="action-button bg-red-500 hover:bg-red-600 text-white hidden">One Last Thought... </button> </div>
        <div id="page6-state" class="hidden fade-in-slow content-container relative overflow-hidden min-h-[250px]" style="background: linear-gradient(to bottom, #1e3a8a, #3b82f6); border-radius: 15px; padding: 20px;"> <div id="star-container" class="absolute inset-0 pointer-events-none"></div> <h2 class="text-2xl md:text-3xl font-bold text-yellow-300 romantic-font relative z-10">Feeling Lucky!</h2> <p class="text-gray-100 text-lg relative z-10 mb-4">On a scale of 1-5 stars, how happy am I right now?</p> <div class="rating-stars relative z-10" id="rating-stars"> <span data-value="1">‚òÜ</span><span data-value="2">‚òÜ</span><span data-value="3">‚òÜ</span><span data-value="4">‚òÜ</span><span data-value="5">‚òÜ</span> </div> <p class="text-yellow-300 text-sm mt-2 relative z-10">(Hint: It's definitely 5! ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê)</p> <button id="goto-page7-button" class="action-button bg-emerald-500 hover:bg-emerald-600 text-white relative z-10 mt-6">The Grand Finale! üèÅ</button> </div>
        <div id="page7-state" class="hidden fade-in-slow content-container"> <div class="final-burst text-yellow-400 mb-4">üéâ‚ú®ü•≥</div> <h2 class="text-3xl md:text-4xl font-bold text-indigo-600 romantic-font">See you soon, Khushboo!</h2> <p class="text-gray-800 text-lg">Counting down the moments until our date! Get ready for fun!</p> <div class="text-4xl mt-4 text-red-500">‚ù§Ô∏èüíñ‚ù§Ô∏è</div> </div>

    </div>

    <script>
        // --- DOM Elements ---
        const states = { question: document.getElementById('question-state'), eligibilityForm: document.getElementById('eligibility-form-state'), verifying: document.getElementById('verifying-state'), eligible: document.getElementById('eligible-state'), rejectionMessage: document.getElementById('rejection-message-state'), rejectionForm: document.getElementById('rejection-form-state'), rejectionThanks: document.getElementById('rejection-thanks-state'), gift: document.getElementById('gift-state'), final: document.getElementById('final-state'), page1: document.getElementById('page1-state'), page2: document.getElementById('page2-state'), page3: document.getElementById('page3-state'), page4: document.getElementById('page4-state'), page5: document.getElementById('page5-state'), page6: document.getElementById('page6-state'), page7: document.getElementById('page7-state') };
        const questionText = document.getElementById('question-text');
        const yesButton = document.getElementById('yes-button');
        const noButton = document.getElementById('no-button');
        const giftBox = document.getElementById('gift-box');
        const heartsBgContainer = document.getElementById('hearts-bg-container');
        const eligibilityForm = document.getElementById('eligibility-form');
        const eligibilityNameInput = document.getElementById('eligibility-name');
        const eligibilityBirthdayInput = document.getElementById('eligibility-birthday');
        const eligibilityHeightFtInput = document.getElementById('eligibility-height-ft');
        const eligibilityHeightInInput = document.getElementById('eligibility-height-in');
        const eligibilityRatingSelect = document.getElementById('eligibility-rating');
        const eligibilityColorInput = document.getElementById('eligibility-fav-color');
        const submitEligibilityButton = document.getElementById('submit-eligibility-button');
        const eligibilityError = document.getElementById('eligibility-error');
        const gotoRejectionFormButton = document.getElementById('goto-rejection-form-button');
        const rejectionFormEl = document.getElementById('rejection-form');
        const rejectionMobileInput = document.getElementById('rejection-mobile');
        const rejectionInstaInput = document.getElementById('rejection-insta');
        const rejectionSnapInput = document.getElementById('rejection-snap');
        const submitRejectionButton = document.getElementById('submit-rejection-button');
        const rejectionFormError = document.getElementById('rejection-form-error');
        const rejectionSendingInfo = document.getElementById('rejection-sending-info');
        const dateInput = document.getElementById('date-input');
        const timeInput = document.getElementById('time-input');
        const customIdeaRadio = document.getElementById('radio-custom');
        const customIdeaText = document.getElementById('custom-idea-text');
        const customInstructionInput = document.getElementById('custom-instruction-input');
        const dateConfirmButton = document.getElementById('date-confirm-button');
        const dateError = document.getElementById('date-error');
        const complimentInput = document.getElementById('compliment-input');
        const complimentNextButton = document.getElementById('compliment-next-button');
        const complimentSendingInfo = document.getElementById('compliment-sending-info');
        const interactiveHeart = document.getElementById('interactive-heart');
        const starContainer = document.getElementById('star-container');
        const ratingStarsContainer = document.getElementById('rating-stars');
        const gameArea = document.getElementById('page4-game-area');
        const clickableHeart = document.getElementById('clickable-heart');
        const gameScoreDisplay = document.getElementById('game-score');
        const gameTimeDisplay = document.getElementById('game-time');
        const gameMessage = document.getElementById('game-message');
        const madLibAdj1 = document.getElementById('madlib-adj1');
        const madLibNoun1 = document.getElementById('madlib-noun1');
        const madLibVerb1 = document.getElementById('madlib-verb1');
        const madLibPlace1 = document.getElementById('madlib-place1');
        const generateMadlibButton = document.getElementById('generate-madlib');
        const madlibResult = document.getElementById('madlib-result');
        const gotoPage2Button = document.getElementById('goto-page2-button');
        const gotoPage3Button = document.getElementById('goto-page3-button');
        const gotoPage5Button = document.getElementById('goto-page5-button');
        const gotoPage6Button = document.getElementById('goto-page6-button');
        const gotoPage7Button = document.getElementById('goto-page7-button');

        // --- State Variables ---
        let noClickCount = 0; let yesButtonScale = 1; let heartColorIndex = 0;
        const heartColors = ['#e11d48', '#ec4899', '#f472b6', '#f9a8d4'];
        // --- URL for Data Submission ---
        const GOOGLE_APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwG8bUel4HmMvLmoskd9V4thpFKV7GjYACXU0bPXuC_DgHePbEdj5D1outc-usRObNe/exec"; // Your Apps Script URL
        const FORMSPREE_URL = "https://formspree.io/f/mjkwyovj"; // Your Formspree URL

        const RECIPIENT_NAME = "Khushboo";
        const TARGET_BIRTHDAY = "2007-09-23";

        let gameScore = 0; let gameTimerId = null; let gameTimeLeft = 10; let gameActive = false;
        let gameSynth = null; let finaleSynth = null;
        let successSynth = null; let failureSynth = null; // Synths for eligibility sounds
        let storedEligibilityData = {};
        let storedDate = ""; let storedTime = ""; let storedIdea = "";
        let storedDateInstructions = [];
        let storedCustomInstruction = "";

        // --- Functions ---
        function initAudio() { if (!gameSynth) { gameSynth = new Tone.Synth({ oscillator: { type: 'sine' }, envelope: { attack: 0.01, decay: 0.1, sustain: 0.01, release: 0.1 } }).toDestination(); } if (!finaleSynth) { finaleSynth = new Tone.PolySynth(Tone.Synth).toDestination(); } if (!successSynth) { successSynth = new Tone.PolySynth({polyphony: 4, voice: Tone.Synth, options: { oscillator: {type: 'triangle'}, envelope: { attack: 0.01, decay: 0.1, sustain: 0.3, release: 0.4 } }}).toDestination(); } if (!failureSynth) { failureSynth = new Tone.Synth({ oscillator: { type: 'sawtooth' }, envelope: { attack: 0.05, decay: 0.5, sustain: 0, release: 0.2 } }).toDestination(); } console.log("Audio initialized."); }
        // Success: Quick ascending arpeggio
        function playSuccessSound() { if (successSynth) { const now = Tone.now(); successSynth.triggerAttackRelease(["C5", "E5", "G5", "C6"], "8n", now); } }
        // Failure: Low dissonant notes
        function playFailureSound() { if (failureSynth) { failureSynth.triggerAttackRelease("C3", "2n", Tone.now()); failureSynth.triggerAttackRelease("C#3", "2n", Tone.now() + 0.1); } }

        function showState(stateToShow) { console.log("Showing state:", stateToShow ? stateToShow.id : 'null'); Object.values(states).forEach(state => { if (state && stateToShow && state.id === stateToShow.id) { state.classList.remove('hidden'); resetPage(state); if (state.id === 'page4-state') startGame(); if (state.id === 'page6-state') createStars(); if (state.id === 'page7-state') playFinaleSound(); } else if (state) { state.classList.add('hidden'); } }); }
        function resetPage(element) { if (!element) return; element.classList.remove('fade-in-slow'); requestAnimationFrame(() => { if (element) element.classList.add('fade-in-slow'); }); }
        function handleNoClick() { console.log("No button clicked! Count:", noClickCount + 1); noClickCount++; yesButtonScale += 0.2; if (yesButton) yesButton.style.transform = `scale(${yesButtonScale})`; if (noClickCount === 1) { if (questionText) questionText.textContent = 'Please you can think about it.. ‚ù§Ô∏è'; if (noButton) noButton.addEventListener('mouseover', moveNoButton); console.log("Mouseover listener added to No button."); moveNoButton(); } else { console.log("Subsequent No click - moving button again."); moveNoButton(); } }
        function moveNoButton() { if (!noButton || !yesButton) return; console.log("moveNoButton called"); if (!noButton.classList.contains('moving')) { noButton.classList.add('moving'); console.log("Added 'moving' class"); } const vpW = window.innerWidth; const vpH = window.innerHeight; const btnRect = noButton.getBoundingClientRect(); const maxT = vpH - btnRect.height - 20; const maxL = vpW - btnRect.width - 20; let newT = Math.random() * maxT; let newL = Math.random() * maxL; const yesRect = yesButton.getBoundingClientRect(); let att = 0; const maxAtt = 20; while (att < maxAtt && newL < yesRect.right && newL + btnRect.width > yesRect.left && newT < yesRect.bottom && newT + btnRect.height > yesRect.top) { newT = Math.random() * maxT; newL = Math.random() * maxL; att++; } noButton.style.top = `${newT}px`; noButton.style.left = `${newL}px`; console.log(`Moved No button to: top=${newT.toFixed(0)}px, left=${newL.toFixed(0)}px`); }
        function createBgHearts() { if (!heartsBgContainer) return; heartsBgContainer.innerHTML = ''; const heartCount = 30; for (let i = 0; i < heartCount; i++) { const heart = document.createElement('div'); heart.classList.add('heart-bg'); heart.textContent = ['üíñ', '‚ù§Ô∏è', 'üíï'][Math.floor(Math.random() * 3)]; heart.style.left = `${Math.random() * 100}vw`; heart.style.top = `${Math.random() * 100}vh`; heart.style.animationDelay = `${Math.random() * 8}s`; heart.style.fontSize = `${10 + Math.random() * 20}px`; heartsBgContainer.appendChild(heart); } }
        function createConfetti() { const confettiCount = 200; const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4caf50', '#8bc34a', '#cddc39', '#ffeb3b', '#ffc107', '#ff9800', '#ff5722']; const originEl = states.eligible; if (!originEl || originEl.classList.contains('hidden')) return; const originRect = originEl.getBoundingClientRect(); const originX = originRect.left + originRect.width / 2; const originY = originRect.top + originRect.height / 3; for (let i = 0; i < confettiCount; i++) { const conf = document.createElement('div'); conf.classList.add('confetti'); conf.style.left = `${originX}px`; conf.style.top = `${originY}px`; conf.style.width = `${4 + Math.random() * 6}px`; conf.style.height = conf.style.width; conf.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)]; conf.style.opacity = '1'; conf.style.transform = `rotate(${Math.random() * 360}deg)`; document.body.appendChild(conf); const angle = Math.random() * Math.PI * 2; const vel = 60 + Math.random() * 110; const grav = 0.9; let vx = Math.cos(angle) * vel; let vy = Math.sin(angle) * vel; let x = originX; let y = originY; let rot = parseFloat(conf.style.transform.replace('rotate(', '').replace('deg)', '')); const rotSpd = (Math.random() - 0.5) * 15; const fall = () => { vy -= grav; x += vx * 0.018; y -= vy * 0.018; rot += rotSpd; conf.style.left = `${x}px`; conf.style.top = `${y}px`; conf.style.transform = `rotate(${rot}deg)`; conf.style.opacity = `${parseFloat(conf.style.opacity) - 0.008}`; if (y < window.innerHeight + 60 && parseFloat(conf.style.opacity) > 0) { requestAnimationFrame(fall); } else { conf.remove(); } }; requestAnimationFrame(fall); } }
        function changeHeartColor() { if (!interactiveHeart) return; heartColorIndex = (heartColorIndex + 1) % heartColors.length; interactiveHeart.style.color = heartColors[heartColorIndex]; }
        function createStars() { if (!starContainer) return; starContainer.innerHTML = ''; const starCount = 50; for (let i = 0; i < starCount; i++) { const star = document.createElement('div'); star.classList.add('star'); star.textContent = '‚ú®'; star.style.left = `${Math.random() * 100}%`; star.style.top = `${Math.random() * 100}%`; star.style.animationDelay = `${Math.random() * 3}s`; starContainer.appendChild(star); } }
        function handleStarRating(event) { if (!ratingStarsContainer) return; if (event.target.tagName === 'SPAN') { const value = parseInt(event.target.dataset.value); const stars = ratingStarsContainer.querySelectorAll('span'); stars.forEach(star => { star.classList.toggle('active', parseInt(star.dataset.value) <= value); star.textContent = parseInt(star.dataset.value) <= value ? '‚òÖ' : '‚òÜ'; }); } }
        function startGame() { Tone.start(); initAudio(); if (gameActive || !gameArea || !clickableHeart || !gameScoreDisplay || !gameTimeDisplay || !gameMessage || !gotoPage5Button) return; console.log("Starting game..."); gameActive = true; gameScore = 0; gameTimeLeft = 10; gameScoreDisplay.textContent = gameScore; gameTimeDisplay.textContent = gameTimeLeft; gameMessage.textContent = ""; clickableHeart.style.display = 'block'; gotoPage5Button.classList.add('hidden'); moveClickableHeart(); gameTimerId = setInterval(gameTick, 1000); }
        function gameTick() { gameTimeLeft--; if(gameTimeDisplay) gameTimeDisplay.textContent = gameTimeLeft; if (gameTimeLeft <= 0) { endGame(); } else { moveClickableHeart(); } }
        function moveClickableHeart() { if (!gameActive || !gameArea || !clickableHeart) return; const areaRect = gameArea.getBoundingClientRect(); const heartRect = clickableHeart.getBoundingClientRect(); const maxTop = gameArea.clientHeight - heartRect.height; const maxLeft = gameArea.clientWidth - heartRect.width; clickableHeart.style.top = `${Math.random() * maxTop}px`; clickableHeart.style.left = `${Math.random() * maxLeft}px`; }
        function clickHeart() { if (!gameActive || !gameSynth || !gameScoreDisplay || !clickableHeart) return; gameScore++; gameScoreDisplay.textContent = gameScore; gameSynth.triggerAttackRelease("C5", "8n"); clickableHeart.style.transform = 'scale(1.2)'; setTimeout(() => { if(clickableHeart) clickableHeart.style.transform = 'scale(1)'; }, 100); moveClickableHeart(); }
        function endGame() { console.log("Ending game..."); clearInterval(gameTimerId); gameActive = false; if(clickableHeart) clickableHeart.style.display = 'none'; if(gameMessage) gameMessage.textContent = `Game Over! Final Score: ${gameScore}. Nice reflexes! üòâ`; if(gotoPage5Button) gotoPage5Button.classList.remove('hidden'); }
        function generateMadLibStory() { if (!madLibAdj1 || !madLibNoun1 || !madLibVerb1 || !madLibPlace1 || !madlibResult || !gotoPage6Button) return; const adj1 = madLibAdj1.value.trim() || "sparkly"; const noun1 = madLibNoun1.value.trim() || "unicorn"; const verb1 = madLibVerb1.value.trim() || "dances"; const place1 = madLibPlace1.value.trim() || "moon"; const story = `Once upon a time, a ${adj1} ${noun1} decided it wanted to meet Khushboo. So, it bravely ${verb1} all the way to the ${place1} just to say 'Hi!' What an adventure!`; madlibResult.textContent = story; madlibResult.classList.remove('hidden'); gotoPage6Button.classList.remove('hidden'); }
        function playFinaleSound() { Tone.start(); initAudio(); try { if (finaleSynth) finaleSynth.triggerAttackRelease(["C4", "E4", "G4"], "1n"); console.log("Finale sound played."); } catch (e) { console.error("Tone.js sound error:", e); } }

        // --- Function to send data to BACKEND (Apps Script) ---
        async function sendDataToBackend(formData, buttonElement, infoElement) {
            // Check if the URL is the placeholder
            if (!GOOGLE_APPS_SCRIPT_URL || GOOGLE_APPS_SCRIPT_URL === "YOUR_GOOGLE_APPS_SCRIPT_URL") {
                console.error("Google Apps Script URL is not set in the code!");
                return; // Stop if URL is missing
            }
            // Add recipient name if not already present
            if (!formData.recipient_name) formData.recipient_name = RECIPIENT_NAME;

            if(buttonElement) buttonElement.disabled = true; if(infoElement) infoElement.classList.remove('hidden');
            console.log("Attempting to send data to Apps Script:", formData);

            try {
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Use no-cors for simple Apps Script deployment
                    body: JSON.stringify(formData),
                    headers: { 'Content-Type': 'text/plain', } // Send as text/plain for simpler doPost handling
                });
                // Cannot reliably check response status with no-cors
                console.log('Data send initiated to Google Apps Script (no-cors).');

            } catch (error) {
                console.error('Network or other error sending data to Google Apps Script:', error);
            } finally {
                // Re-enable button and hide sending message
                if(buttonElement) buttonElement.disabled = false;
                if(infoElement) infoElement.classList.add('hidden');
                console.log("Finished initiating send attempt to Apps Script.");
            }
        }


        // --- Event Listeners Setup ---
        document.addEventListener('DOMContentLoaded', (event) => {
            console.log("DOM fully loaded and parsed");
            // Select elements safely after DOM load
            const yesBtn = document.getElementById('yes-button');
            const noBtn = document.getElementById('no-button');
            const giftBtn = document.getElementById('gift-box');
            const submitEligibilityBtn = document.getElementById('submit-eligibility-button');
            const gotoRejectionFormBtn = document.getElementById('goto-rejection-form-button');
            const rejectionFormEl = document.getElementById('rejection-form');
            const submitRejectionBtn = document.getElementById('submit-rejection-button');
            const dateConfirmBtn = document.getElementById('date-confirm-button');
            const complimentNextBtn = document.getElementById('compliment-next-button');
            const genMadlibBtn = document.getElementById('generate-madlib');
            const clickableHeartBtn = document.getElementById('clickable-heart');
            const ratingStarsCont = document.getElementById('rating-stars');
            // Navigation buttons
            const page2Btn = document.getElementById('goto-page2-button');
            const page3Btn = document.getElementById('goto-page3-button');
            const page5Btn = document.getElementById('goto-page5-button');
            const page6Btn = document.getElementById('goto-page6-button');
            const page7Btn = document.getElementById('goto-page7-button');

            // Add listener for YES button
            if (yesBtn) { yesBtn.addEventListener('click', () => { console.log("Yes button clicked!"); Tone.start(); initAudio(); showState(states.eligibilityForm); createBgHearts(); }); console.log("Yes button listener added."); } else { console.error("Could not find Yes button!"); }
            if (noBtn) { noBtn.addEventListener('click', handleNoClick); console.log("No button click listener added."); } else { console.error("Could not find No button!"); }

             // --- Listener for Eligibility Form Submission ---
            if (eligibilityForm) {
                eligibilityForm.addEventListener('submit', (e) => {
                    e.preventDefault(); console.log("Eligibility form submitted."); Tone.start(); initAudio();
                    if(eligibilityError) eligibilityError.classList.add('hidden');
                    const enteredName = eligibilityNameInput ? eligibilityNameInput.value.trim().toLowerCase() : '';
                    const enteredBday = eligibilityBirthdayInput ? eligibilityBirthdayInput.value : '';
                    const heightFt = eligibilityHeightFtInput ? eligibilityHeightFtInput.value : '';
                    const heightIn = eligibilityHeightInInput ? eligibilityHeightInInput.value : '';
                    const rating = eligibilityRatingSelect ? eligibilityRatingSelect.value : '';
                    const color = eligibilityColorInput ? eligibilityColorInput.value.trim() : '';
                    const drinkChecked = document.querySelector('input[name="eligibility_drink"]:checked');
                    const drinkPref = drinkChecked ? drinkChecked.value : '';
                    if (!enteredName || !enteredBday || !heightFt || heightIn === '' || !rating || !drinkPref) { if(eligibilityError) { eligibilityError.textContent = "Please fill out Name, Birthday, Height, Rating, and Drink Preference!"; eligibilityError.classList.remove('hidden'); } return; }
                    // Store Eligibility Data Temporarily
                    storedEligibilityData = { name_entered: eligibilityNameInput.value.trim(), birthday_entered: enteredBday, height_ft: heightFt, height_in: heightIn, persistence_rating: rating, fav_color: color || 'Not specified', drink_preference: drinkPref };
                    console.log("Stored Eligibility Data:", storedEligibilityData);
                    // Eligibility Check
                    const isNameMatch = enteredName === "khushboo" || enteredName === "khushboo swami";
                    const isBdayMatch = enteredBday === TARGET_BIRTHDAY;
                    console.log(`Validation - Name: ${enteredName}, Bday: ${enteredBday}. Match? Name: ${isNameMatch}, Bday: ${isBdayMatch}`);

                    // Show Verifying state FIRST
                    showState(states.verifying);

                    // Wait 4.5 seconds THEN check and show result
                    setTimeout(() => {
                        if (isNameMatch && isBdayMatch) {
                            // SUCCESS PATH - NO SEND YET
                            console.log("Eligibility PASSED!");
                            playSuccessSound(); // Play success sound
                            showState(states.eligible);
                            setTimeout(() => { showState(states.gift); createConfetti(); }, 3000); // Show gift after 3s
                        } else {
                            // FAILURE PATH - NO SEND YET
                            console.log("Eligibility FAILED!");
                            playFailureSound(); // Play failure sound
                            showState(states.rejectionMessage);
                        }
                    }, 4500); // 4.5 second delay (adjust as needed)

                }); console.log("Eligibility form submit listener added.");
            } else { console.error("Could not find Eligibility form!"); }

            // Listener for button on rejection message page
            if (gotoRejectionFormButton) { gotoRejectionFormButton.addEventListener('click', () => { showState(states.rejectionForm); }); console.log("Goto Rejection Form button listener added."); } else { console.error("Could not find Goto Rejection Form button!"); }

            // --- Listener for Rejection Form Submission ---
            // This sends the COMBINED eligibility (failed) + rejection contact data
            if (rejectionFormEl) {
                 rejectionFormEl.addEventListener('submit', async (e) => {
                    e.preventDefault(); console.log("Rejection form submitted."); Tone.start(); initAudio();
                    if (rejectionFormError) rejectionFormError.classList.add('hidden');
                    const mobile = rejectionMobileInput ? rejectionMobileInput.value.trim() : '';
                    const insta = rejectionInstaInput ? rejectionInstaInput.value.trim() : '';
                    const snap = rejectionSnapInput ? rejectionSnapInput.value.trim() : '';
                    const mobileRegex = /^[0-9]{10,15}$/; // Basic validation
                    if (!mobile || !mobileRegex.test(mobile.replace(/[^0-9]/g, ''))) { if (rejectionFormError) { rejectionFormError.textContent = "Please enter a valid mobile number (digits only, include country code)."; rejectionFormError.classList.remove('hidden'); } return; }
                     // Prepare rejection data including stored (failed) eligibility data
                    const rejectionData = {
                        recipient_name: RECIPIENT_NAME, stage: "Eligibility Check - FAILED",
                        eligibility_name_entered: storedEligibilityData.name_entered || 'Not provided',
                        eligibility_birthday_entered: storedEligibilityData.birthday_entered || 'Not provided',
                        eligibility_height_ft: storedEligibilityData.height_ft || 'N/A',
                        eligibility_height_in: storedEligibilityData.height_in || 'N/A',
                        persistence_rating: storedEligibilityData.persistence_rating || 'Not provided',
                        fav_color: storedEligibilityData.fav_color || 'Not specified',
                        drink_preference: storedEligibilityData.drink_preference || 'Not provided',
                        rejection_mobile: mobile, rejection_insta: insta || 'Not provided', rejection_snap: snap || 'Not provided'
                    };
                    console.log("Preparing rejection data:", rejectionData);
                    // Send combined data
                    await sendDataToBackend(rejectionData, submitRejectionButton, rejectionSendingInfo);
                    showState(states.rejectionThanks); // Show thank you message
                 }); console.log("Rejection form submit listener added.");
            } else { console.error("Could not find Rejection form!"); }

            // Add listener for Gift Box click
            if (giftBtn) { giftBtn.addEventListener('click', () => { Tone.start(); initAudio(); showState(states.final); }); console.log("Gift button listener added."); } else { console.error("Could not find Gift button!"); }
            // Listener for Date Idea radio buttons
            document.querySelectorAll('input[name="date_idea"]').forEach(radio => { radio.addEventListener('change', () => { if(customIdeaText && customIdeaRadio) { customIdeaText.classList.toggle('hidden', !customIdeaRadio.checked); if (!customIdeaRadio.checked) customIdeaText.value = ''; } }); });

            // --- Listener for Date Confirm Button (State: final) ---
            // This button ONLY stores data and navigates. NO sending here.
            if (dateConfirmBtn) {
                dateConfirmBtn.addEventListener('click', () => {
                    console.log("Date confirm button clicked."); Tone.start(); initAudio();
                    const dateVal = dateInput ? dateInput.value : ''; const timeVal = timeInput ? timeInput.value : '';
                    const ideaRadio = document.querySelector('input[name="date_idea"]:checked'); let ideaVal = '';
                    if (ideaRadio) { ideaVal = ideaRadio.value === 'Custom' ? (customIdeaText ? customIdeaText.value.trim() : '') : ideaRadio.value; }
                    const instructions = [];
                    if(document.getElementById('instruction-flowers')?.checked) instructions.push("Bring Flowers üåπ");
                    if(document.getElementById('instruction-chocolate')?.checked) instructions.push("Chocolate Involved üç´");
                    if(document.getElementById('instruction-punctual')?.checked) instructions.push("Be Punctual ‚è∞");
                    storedCustomInstruction = customInstructionInput ? customInstructionInput.value.trim() : '';
                    if (!dateVal || !timeVal || !ideaVal) { console.log("Date validation failed."); if(dateError) dateError.classList.remove('hidden'); return; }
                     if(dateError) dateError.classList.add('hidden');
                    storedDate = dateVal; storedTime = timeVal; storedIdea = ideaVal; storedDateInstructions = instructions;
                    console.log("Stored Date Info:", { storedDate, storedTime, storedIdea, storedDateInstructions, storedCustomInstruction });
                    showState(states.page1); // --- ONLY transition to the next page ---
                }); console.log("Date Confirm button listener added (no send).");
            } else { console.error("Could not find Date Confirm button!"); }

            // --- Listener for Compliment Next Button (State: page3) ---
            // This button sends ALL final data (Eligibility + Date + Instructions + Compliment + Name) and navigates.
            if (complimentNextBtn) {
                complimentNextBtn.addEventListener('click', () => {
                    console.log("Compliment Next button listener triggered."); Tone.start(); initAudio();
                    const compliment = complimentInput ? complimentInput.value.trim() : '';
                    console.log("Compliment entered:", compliment);
                    console.log("Data available right before final send:", { storedEligibilityData, storedDate, storedTime, storedIdea, storedDateInstructions, storedCustomInstruction });

                    // Prepare data including ALL previously stored info
                     const fullFormData = {
                        recipient_name: RECIPIENT_NAME, stage: "SUCCESS - All Data",
                        // Eligibility Data
                        eligibility_name_entered: storedEligibilityData.name_entered || 'Not specified',
                        eligibility_birthday_entered: storedEligibilityData.birthday_entered || 'Not specified',
                        eligibility_height_ft: storedEligibilityData.height_ft || 'N/A', // Include height
                        eligibility_height_in: storedEligibilityData.height_in || 'N/A', // Include height
                        persistence_rating: storedEligibilityData.persistence_rating || 'Not specified',
                        fav_color: storedEligibilityData.fav_color || 'Not specified',
                        drink_preference: storedEligibilityData.drink_preference || 'Not specified',
                        // Date/Time/Idea Data
                        date: storedDate || 'Not specified', time: storedTime || 'Not specified', idea: storedIdea || 'Not specified',
                        date_instructions_checklist: storedDateInstructions.length > 0 ? storedDateInstructions.join(', ') : 'None selected',
                        custom_instruction: storedCustomInstruction || 'None',
                        // Compliment
                        compliment: compliment || '(Left blank)',
                    };
                    console.log("Preparing full form data for final send:", fullFormData);
                    // Send ALL data in the background, DO NOT wait for it
                    sendDataToBackend(fullFormData, complimentNextBtn, complimentSendingInfo);
                    // --- Immediately transition to the next page ---
                    showState(states.page4);
                });
                 console.log("Compliment Next button listener added (sends all data).");
            } else { console.error("Could not find Compliment Next button!"); }

            // Page 4 Game Listener
            if (clickableHeartBtn) { clickableHeartBtn.addEventListener('click', clickHeart); console.log("Clickable Heart listener added."); } else { console.error("Could not find Clickable Heart button!"); }
            // Page 5 Mad Libs Listener
            if (genMadlibBtn) { genMadlibBtn.addEventListener('click', generateMadLibStory); console.log("Generate Madlib listener added."); } else { console.error("Could not find Generate Madlib button!"); }
            // Navigation (remaining buttons)
            if (page2Btn) { page2Btn.addEventListener('click', () => showState(states.page2)); console.log("Goto Page 2 listener added."); } else { console.error("Could not find Goto Page 2 button!"); }
            if (page3Btn) { page3Btn.addEventListener('click', () => showState(states.page3)); console.log("Goto Page 3 listener added."); } else { console.error("Could not find Goto Page 3 button!"); }
            if (page5Btn) { page5Btn.addEventListener('click', () => showState(states.page5)); console.log("Goto Page 5 listener added."); } else { console.error("Could not find Goto Page 5 button!"); }
            if (page6Btn) { page6Btn.addEventListener('click', () => showState(states.page6)); console.log("Goto Page 6 listener added."); } else { console.error("Could not find Goto Page 6 button!"); }
            if (page7Btn) { page7Btn.addEventListener('click', () => showState(states.page7)); console.log("Goto Page 7 listener added."); } else { console.error("Could not find Goto Page 7 button!"); }
            if (ratingStarsCont) { ratingStarsCont.addEventListener('click', handleStarRating); console.log("Rating Stars listener added."); } else { console.error("Could not find Rating Stars container!"); }

            createBgHearts(); // Initialize Background Hearts
        });

    </script>
</body>
</html>
